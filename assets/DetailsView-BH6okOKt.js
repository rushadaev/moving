import{k as se,l as oe,m as S,n as z,p as E,q as b,s as V,x as te,y as re,z as G,d as K,A as ne,B as ae,c as j,C as le,r as $,D as m,N as ie,E as ce,I as C,J as de,K as ue,L as pe,M as ge,O as me,W as fe,P as ve,S as he,Q as be,R as ye,u as Ce,T as _e,U as Re,a as B,b as _,e as a,V as d,h as F,G as M,X as L,f as N,j as qe,o as k,H as xe,Y as Ie,i as W,t as w,Z as D,$ as O,a0 as Pe,F as Se,_ as ze}from"./index-wW9rBK64.js";function ke(u){const{lineHeight:t,borderRadius:s,fontWeightStrong:R,baseColor:l,dividerColor:f,actionColor:h,textColor1:g,textColor2:n,closeColorHover:v,closeColorPressed:p,closeIconColor:q,closeIconColorHover:x,closeIconColorPressed:i,infoColor:r,successColor:T,warningColor:I,errorColor:P,fontSize:H}=u;return Object.assign(Object.assign({},oe),{fontSize:H,lineHeight:t,titleFontWeight:R,borderRadius:s,border:`1px solid ${f}`,color:h,titleTextColor:g,iconColor:n,contentTextColor:n,closeBorderRadius:s,closeColorHover:v,closeColorPressed:p,closeIconColor:q,closeIconColorHover:x,closeIconColorPressed:i,borderInfo:`1px solid ${S(l,z(r,{alpha:.25}))}`,colorInfo:S(l,z(r,{alpha:.08})),titleTextColorInfo:g,iconColorInfo:r,contentTextColorInfo:n,closeColorHoverInfo:v,closeColorPressedInfo:p,closeIconColorInfo:q,closeIconColorHoverInfo:x,closeIconColorPressedInfo:i,borderSuccess:`1px solid ${S(l,z(T,{alpha:.25}))}`,colorSuccess:S(l,z(T,{alpha:.08})),titleTextColorSuccess:g,iconColorSuccess:T,contentTextColorSuccess:n,closeColorHoverSuccess:v,closeColorPressedSuccess:p,closeIconColorSuccess:q,closeIconColorHoverSuccess:x,closeIconColorPressedSuccess:i,borderWarning:`1px solid ${S(l,z(I,{alpha:.33}))}`,colorWarning:S(l,z(I,{alpha:.08})),titleTextColorWarning:g,iconColorWarning:I,contentTextColorWarning:n,closeColorHoverWarning:v,closeColorPressedWarning:p,closeIconColorWarning:q,closeIconColorHoverWarning:x,closeIconColorPressedWarning:i,borderError:`1px solid ${S(l,z(P,{alpha:.25}))}`,colorError:S(l,z(P,{alpha:.08})),titleTextColorError:g,iconColorError:P,contentTextColorError:n,closeColorHoverError:v,closeColorPressedError:p,closeIconColorError:q,closeIconColorHoverError:x,closeIconColorPressedError:i})}const Te={name:"Alert",common:se,self:ke},we=E("alert",`
 line-height: var(--n-line-height);
 border-radius: var(--n-border-radius);
 position: relative;
 transition: background-color .3s var(--n-bezier);
 background-color: var(--n-color);
 text-align: start;
 word-break: break-word;
`,[b("border",`
 border-radius: inherit;
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 transition: border-color .3s var(--n-bezier);
 border: var(--n-border);
 pointer-events: none;
 `),V("closable",[E("alert-body",[b("title",`
 padding-right: 24px;
 `)])]),b("icon",{color:"var(--n-icon-color)"}),E("alert-body",{padding:"var(--n-padding)"},[b("title",{color:"var(--n-title-text-color)"}),b("content",{color:"var(--n-content-text-color)"})]),te({originalTransition:"transform .3s var(--n-bezier)",enterToProps:{transform:"scale(1)"},leaveToProps:{transform:"scale(0.9)"}}),b("icon",`
 position: absolute;
 left: 0;
 top: 0;
 align-items: center;
 justify-content: center;
 display: flex;
 width: var(--n-icon-size);
 height: var(--n-icon-size);
 font-size: var(--n-icon-size);
 margin: var(--n-icon-margin);
 `),b("close",`
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 position: absolute;
 right: 0;
 top: 0;
 margin: var(--n-close-margin);
 `),V("show-icon",[E("alert-body",{paddingLeft:"calc(var(--n-icon-margin-left) + var(--n-icon-size) + var(--n-icon-margin-right))"})]),V("right-adjust",[E("alert-body",{paddingRight:"calc(var(--n-close-size) + var(--n-padding) + 2px)"})]),E("alert-body",`
 border-radius: var(--n-border-radius);
 transition: border-color .3s var(--n-bezier);
 `,[b("title",`
 transition: color .3s var(--n-bezier);
 font-size: 16px;
 line-height: 19px;
 font-weight: var(--n-title-font-weight);
 `,[re("& +",[b("content",{marginTop:"9px"})])]),b("content",{transition:"color .3s var(--n-bezier)",fontSize:"var(--n-font-size)"})]),b("icon",{transition:"color .3s var(--n-bezier)"})]),$e=Object.assign(Object.assign({},G.props),{title:String,showIcon:{type:Boolean,default:!0},type:{type:String,default:"default"},bordered:{type:Boolean,default:!0},closable:Boolean,onClose:Function,onAfterLeave:Function,onAfterHide:Function}),Ae=K({name:"Alert",inheritAttrs:!1,props:$e,slots:Object,setup(u){const{mergedClsPrefixRef:t,mergedBorderedRef:s,inlineThemeDisabled:R,mergedRtlRef:l}=ne(u),f=G("Alert","-alert",we,Te,u,t),h=ae("Alert",l,t),g=j(()=>{const{common:{cubicBezierEaseInOut:i},self:r}=f.value,{fontSize:T,borderRadius:I,titleFontWeight:P,lineHeight:H,iconSize:o,iconMargin:e,iconMarginRtl:c,closeIconSize:A,closeBorderRadius:U,closeSize:J,closeMargin:Q,closeMarginRtl:X,padding:Y}=r,{type:y}=u,{left:Z,right:ee}=ce(e);return{"--n-bezier":i,"--n-color":r[C("color",y)],"--n-close-icon-size":A,"--n-close-border-radius":U,"--n-close-color-hover":r[C("closeColorHover",y)],"--n-close-color-pressed":r[C("closeColorPressed",y)],"--n-close-icon-color":r[C("closeIconColor",y)],"--n-close-icon-color-hover":r[C("closeIconColorHover",y)],"--n-close-icon-color-pressed":r[C("closeIconColorPressed",y)],"--n-icon-color":r[C("iconColor",y)],"--n-border":r[C("border",y)],"--n-title-text-color":r[C("titleTextColor",y)],"--n-content-text-color":r[C("contentTextColor",y)],"--n-line-height":H,"--n-border-radius":I,"--n-font-size":T,"--n-title-font-weight":P,"--n-icon-size":o,"--n-icon-margin":e,"--n-icon-margin-rtl":c,"--n-close-size":J,"--n-close-margin":Q,"--n-close-margin-rtl":X,"--n-padding":Y,"--n-icon-margin-left":Z,"--n-icon-margin-right":ee}}),n=R?le("alert",j(()=>u.type[0]),g,u):void 0,v=$(!0),p=()=>{const{onAfterLeave:i,onAfterHide:r}=u;i&&i(),r&&r()};return{rtlEnabled:h,mergedClsPrefix:t,mergedBordered:s,visible:v,handleCloseClick:()=>{var i;Promise.resolve((i=u.onClose)===null||i===void 0?void 0:i.call(u)).then(r=>{r!==!1&&(v.value=!1)})},handleAfterLeave:()=>{p()},mergedTheme:f,cssVars:R?void 0:g,themeClass:n==null?void 0:n.themeClass,onRender:n==null?void 0:n.onRender}},render(){var u;return(u=this.onRender)===null||u===void 0||u.call(this),m(ie,{onAfterLeave:this.handleAfterLeave},{default:()=>{const{mergedClsPrefix:t,$slots:s}=this,R={class:[`${t}-alert`,this.themeClass,this.closable&&`${t}-alert--closable`,this.showIcon&&`${t}-alert--show-icon`,!this.title&&this.closable&&`${t}-alert--right-adjust`,this.rtlEnabled&&`${t}-alert--rtl`],style:this.cssVars,role:"alert"};return this.visible?m("div",Object.assign({},de(this.$attrs,R)),this.closable&&m(ue,{clsPrefix:t,class:`${t}-alert__close`,onClick:this.handleCloseClick}),this.bordered&&m("div",{class:`${t}-alert__border`}),this.showIcon&&m("div",{class:`${t}-alert__icon`,"aria-hidden":"true"},pe(s.icon,()=>[m(ge,{clsPrefix:t},{default:()=>{switch(this.type){case"success":return m(he,null);case"info":return m(ve,null);case"warning":return m(fe,null);case"error":return m(me,null);default:return null}}})])),m("div",{class:[`${t}-alert-body`,this.mergedBordered&&`${t}-alert-body--bordered`]},be(s.header,l=>{const f=l||this.title;return f?m("div",{class:`${t}-alert-body__title`},f):null}),s.default&&m("div",{class:`${t}-alert-body__content`},s))):null}})}}),Ee={class:"details-page"},Be={class:"details-content"},Fe={key:0,class:"loading-container"},He={key:1,class:"error-container"},We={key:2,class:"form-container"},Me={class:"summary-grid"},Ne={class:"summary-row"},Ve={class:"summary-value price-value"},je={class:"summary-row"},Le={key:0,class:"summary-row"},De={class:"summary-value tips-value"},Oe={class:"tips-percentage"},Ge={key:1,class:"summary-row"},Ke={class:"summary-row total-row"},Ue={class:"summary-value total-value"},Je={class:"action-buttons"},Qe=K({__name:"DetailsView",setup(u){const t=qe(),s=ye(),R=Ce(),l=_e(),f=$(!1),h=$(!1),g=$(!1),n=$(""),v=$(),p=$({property_type:"residential",square_feet:1e3,additional_objects:[],movers_count:2,hourly_rate:100,departure_time:"",bedrooms:2,addresses:[{address:"",type:"loading",order:0,latitude:0,longitude:0},{address:"",type:"unloading",order:1,latitude:0,longitude:0}],materials:[],packing_options:[]});Re(async()=>{if(!R.isAuthenticated){t.push("/requests");return}f.value=!0,n.value="";try{const o=Number(t.currentRoute.value.query.id);if(o){if((!s.selectedRequest||s.selectedRequest.id!==o)&&(!await s.getRequestById(o)||!s.selectedRequest)){n.value=`Failed to load request #${o}`,f.value=!1;return}g.value=!0;const e=s.selectedRequest;console.log("Loading request data:",e),console.log("Original addresses from API:",e.addresses),p.value={property_type:e.property_type||"residential",square_feet:e.square_feet||1e3,additional_objects:e.additional_objects||[],movers_count:e.movers_count||2,hourly_rate:e.hourly_rate||100,departure_time:e.departure_time||"",bedrooms:e.bedrooms||2,packing_options:e.packing_options||[],addresses:e.addresses&&e.addresses.length>0?e.addresses.map(c=>(console.log("Processing address:",c),console.log("location_type value:",c.location_type,"type:",typeof c.location_type),{...c,location_type:c.location_type})):[{address:"",type:"loading",location_type:null,order:0,latitude:0,longitude:0},{address:"",type:"unloading",location_type:null,order:1,latitude:0,longitude:0}],materials:e.materials||[]},console.log("Form data after initialization:",p.value),console.log("Processed addresses:",p.value.addresses)}}catch(o){console.error("Error loading request:",o),n.value="Failed to load request details"}finally{f.value=!1}});const q=o=>(console.log("Preparing data for API:",o),console.log("Addresses with location_type:",o.addresses.map(e=>({address:e.address,type:e.type,location_type:e.location_type}))),o),x=async()=>{var o;if(i()){h.value=!0;try{if(g.value&&((o=s.selectedRequest)!=null&&o.id)){const e=q(p.value);await s.updateRequest(s.selectedRequest.id,e)?(l.success("Request updated successfully!"),t.push("/requests")):l.error("Failed to update request")}}catch(e){l.error("An error occurred while saving"),console.error("Save error:",e)}finally{h.value=!1}}},i=()=>{if(!v.value)return!1;const o=v.value.validate();return o.valid?!0:(l.error(o.message),!1)},r=()=>{var o;(o=s.selectedRequest)!=null&&o.id&&t.push({path:"/tracking",query:{id:s.selectedRequest.id}})},T=()=>{t.push("/requests")},I=o=>({pending:"status-pending",paid:"status-paid",processing:"status-processing",failed:"status-failed"})[o]||"status-pending",P=o=>({pending:"Pending",paid:"Paid",processing:"Processing",failed:"Failed"})[o]||"Pending",H=()=>{var c,A;const o=Number(((c=s.selectedRequest)==null?void 0:c.price)||0),e=Number(((A=s.selectedRequest)==null?void 0:A.tips_amount)||0);return(o+e).toFixed(2)};return(o,e)=>(k(),B("div",Ee,[_(xe,{title:"Request Details"}),a("main",Be,[f.value?(k(),B("div",Fe,[_(d(Ie),{size:"medium"}),e[2]||(e[2]=a("p",null,"Loading request details...",-1))])):n.value?(k(),B("div",He,[_(d(Ae),{type:"error",title:n.value},null,8,["title"]),_(M,{onClick:e[0]||(e[0]=c=>d(t).push("/requests")),class:"mt-4"},{default:F(()=>e[3]||(e[3]=[W(" Back to Requests ")])),_:1})])):(k(),B("div",We,[g.value&&d(s).selectedRequest?(k(),L(d(O),{key:0,class:"financial-summary-card"},{default:F(()=>[e[9]||(e[9]=a("h2",{class:"summary-title"},"Financial Summary",-1)),a("div",Me,[a("div",Ne,[e[4]||(e[4]=a("span",{class:"summary-label"},"Base Price:",-1)),a("span",Ve,"$"+w(d(s).selectedRequest.price||0),1)]),a("div",je,[e[5]||(e[5]=a("span",{class:"summary-label"},"Payment Status:",-1)),a("span",{class:D(["summary-badge",I(d(s).selectedRequest.payment_status)])},w(P(d(s).selectedRequest.payment_status)),3)]),d(s).selectedRequest.tips_amount?(k(),B("div",Le,[e[6]||(e[6]=a("span",{class:"summary-label"},"Tips:",-1)),a("span",De,[W(" $"+w(d(s).selectedRequest.tips_amount)+" ",1),a("span",Oe,"("+w(d(s).selectedRequest.tips_percentage)+"%)",1)])])):N("",!0),d(s).selectedRequest.tips_amount?(k(),B("div",Ge,[e[7]||(e[7]=a("span",{class:"summary-label"},"Tips Payment:",-1)),a("span",{class:D(["summary-badge",I(d(s).selectedRequest.tips_payment_status)])},w(P(d(s).selectedRequest.tips_payment_status)),3)])):N("",!0),a("div",Ke,[e[8]||(e[8]=a("span",{class:"summary-label"},"Total:",-1)),a("span",Ue," $"+w(H()),1)])])]),_:1})):N("",!0),_(d(O),null,{default:F(()=>{var c;return[_(Pe,{ref_key:"requestFormRef",ref:v,modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=A=>p.value=A),mode:"edit",loading:h.value},null,8,["modelValue","loading"]),a("div",Je,[_(M,{onClick:T,disabled:h.value},{default:F(()=>e[10]||(e[10]=[W(" Cancel ")])),_:1},8,["disabled"]),_(M,{onClick:x,disabled:h.value},{default:F(()=>[W(w(h.value?"Saving...":"Save Changes"),1)]),_:1},8,["disabled"]),g.value&&((c=d(s).selectedRequest)!=null&&c.id)?(k(),L(M,{key:0,onClick:r,disabled:h.value},{default:F(()=>e[11]||(e[11]=[W(" Track Request ")])),_:1},8,["disabled"])):N("",!0)])]}),_:1})]))]),_(Se)]))}}),Ye=ze(Qe,[["__scopeId","data-v-a0ffbc98"]]);export{Ye as default};
