import{d as V,k as A,u as $,r as g,c as y,l as F,a as b,b as q,H as N,e as t,t as u,m as p,g as m,n as T,v,h as R,w as j,j as E,o as f,i as w,F as L,_ as M}from"./index-4gi88XVp.js";/* empty css                                                             */import{G as k}from"./GradientButton-DyQeGXpp.js";const B={class:"details-view"},z={key:0,class:"p-5 pb-24 flex justify-center items-center"},G={key:1,class:"p-5 pb-24"},H={class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded"},O={key:2,class:"p-5 pb-24"},P={class:"mb-4"},J={class:"mb-4"},K={class:"mb-4"},Q={class:"mb-4"},Z={class:"mb-4"},W={class:"mb-4"},X={class:"mb-4"},Y={key:3,class:"p-5 pb-24"},ee={class:"bg-[var(--color-background)] rounded-lg p-4 mb-4 shadow-sm"},te={class:"text-[var(--color-text)] font-medium"},se={class:"bg-[var(--color-background)] rounded-lg p-4 mb-4 shadow-sm"},oe={class:"text-[var(--color-text)] font-medium"},ae={class:"grid grid-cols-2 gap-4 mb-4"},le={class:"bg-[var(--color-background)] rounded-lg p-4 shadow-sm"},re={class:"text-[var(--color-text)] font-medium"},de={class:"bg-[var(--color-background)] rounded-lg p-4 shadow-sm"},ue={class:"text-[var(--color-text)] font-medium"},ie={class:"bg-[var(--color-background)] rounded-lg p-4 mb-4 shadow-sm"},ne={class:"text-[var(--color-text)] font-medium"},ce={class:"bg-[var(--color-background)] rounded-lg p-4 mb-4 shadow-sm"},pe={class:"text-[var(--color-text)] font-medium"},me={class:"mb-6"},ve={class:"bg-[var(--color-background)] rounded-lg p-4 shadow-sm"},ge={class:"text-[var(--color-text)] font-medium"},be={class:"grid grid-cols-2 gap-4"},fe=V({__name:"DetailsView",setup(ye){const n=E(),o=A(),_=$(),r=g(!1),c=g(!1),d=g(""),a=g({property_type:"",square_feet:0,additional_objects:[],movers_count:2,hourly_rate:100,departure_time:"",labor_included:!0,package_type:"standard",addresses:[{address:"",type:"loading",order:0,latitude:0,longitude:0},{address:"",type:"unloading",order:1,latitude:0,longitude:0}],materials:[]}),h=y(()=>{var e;return(e=o.selectedRequest)!=null&&e.departure_time?new Date(o.selectedRequest.departure_time).toLocaleDateString():""}),D=y(()=>{var e;return(e=o.selectedRequest)!=null&&e.departure_time?new Date(o.selectedRequest.departure_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""}),C=y(()=>{var l,e;return((e=(l=o.selectedRequest)==null?void 0:l.addresses.find(s=>s.type==="loading"))==null?void 0:e.address)||""}),S=y(()=>{var l,e;return((e=(l=o.selectedRequest)==null?void 0:l.addresses.find(s=>s.type==="unloading"))==null?void 0:e.address)||""});F(async()=>{var l;if(!_.isAuthenticated){n.push("/");return}r.value=!0,d.value="";try{let e=Number(n.currentRoute.value.query.id);if(console.log("DetailsView mounted with query ID:",e),!e&&((l=o.selectedRequest)!=null&&l.id)&&(e=o.selectedRequest.id,console.log(`No ID in URL, using ID from store: ${e}`),n.replace({path:"/details",query:{id:e.toString()}}),c.value=!0),e){if(!o.selectedRequest||o.selectedRequest.id!==e){if(console.log(`Loading request with ID: ${e}`),!await o.getRequestById(e)||!o.selectedRequest){d.value=`Failed to load request #${e}. ${o.error||"Unknown error"}`,console.error("Failed to load request:",o.error),r.value=!1;return}}else console.log("Request already loaded in store:",o.selectedRequest);console.log("Request data loaded:",o.selectedRequest),c.value=!0;const s=o.selectedRequest;a.value={property_type:s.property_type||"",square_feet:s.square_feet||0,additional_objects:s.additional_objects||[],movers_count:s.movers_count||2,hourly_rate:s.hourly_rate||100,departure_time:s.departure_time||"",labor_included:s.labor_included!==void 0?s.labor_included:!0,package_type:s.package_type||"standard",addresses:s.addresses&&s.addresses.length>0?[...s.addresses]:[{address:"",type:"loading",order:0,latitude:0,longitude:0},{address:"",type:"unloading",order:1,latitude:0,longitude:0}],materials:s.materials&&s.materials.length>0?[...s.materials]:[]},console.log("Form data initialized:",a.value)}else console.log("Creating new request (no ID provided)"),c.value=!1}catch(e){console.error("Error initializing details view:",e),d.value="An error occurred while loading request details"}finally{r.value=!1}});async function x(l){try{const s=await(await fetch(`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(l)}&key=AIzaSyCeCJv_Q1i0B4ClZouNC1hND4lIM_D_EOo`)).json();if(s.status==="OK"&&s.results.length>0){const i=s.results[0].geometry.location;return{latitude:i.lat,longitude:i.lng}}return null}catch(e){return console.error("Geocoding error:",e),null}}async function I(){var l;if(!_.isAuthenticated){n.push("/");return}r.value=!0,d.value="";try{let e=await x(a.value.addresses[0].address),s=await x(a.value.addresses[1].address);const i=g({lat:40.7128,lng:-74.006});(!e||!s)&&(e={latitude:i.value.lat,longitude:i.value.lng},s={latitude:i.value.lat,longitude:i.value.lng}),a.value.addresses[0].latitude=e.latitude,a.value.addresses[0].longitude=e.longitude,a.value.addresses[1].latitude=s.latitude,a.value.addresses[1].longitude=s.longitude,c.value&&((l=o.selectedRequest)!=null&&l.id)?await o.updateRequest(o.selectedRequest.id,a.value):await o.createRequest(a.value),n.push("/")}catch(e){console.error("Save request error:",e),d.value="Failed to save request. Please try again."}finally{r.value=!1}}async function U(){var e;if(!((e=o.selectedRequest)!=null&&e.id)){console.error("No request selected or request has no ID"),d.value="Cannot take request: No request selected";return}const l=o.selectedRequest.id;console.log(`Taking request ID: ${l}`),r.value=!0;try{if(!await o.updateRequestStatus(l,"confirmed")){console.error("Failed to update request status"),d.value=`Failed to update request status: ${o.error||"Unknown error"}`;return}console.log("Request status updated successfully, navigating to tracking"),n.push({path:"/tracking",query:{id:l.toString()}})}catch(s){console.error("Error taking request:",s),d.value="Failed to update request status"}finally{r.value=!1}}return(l,e)=>(f(),b("div",B,[q(N,{title:c.value?"Edit Request":"Request Details"},null,8,["title"]),r.value?(f(),b("main",z,e[8]||(e[8]=[t("p",null,"Loading...",-1)]))):d.value?(f(),b("main",G,[t("div",H,[t("p",null,u(d.value),1)])])):c.value||!p(o).selectedRequest?(f(),b("main",O,[t("form",{onSubmit:j(I,["prevent"])},[t("div",P,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium mb-1"},"Property Type",-1)),m(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>a.value.property_type=s),class:"w-full p-2 border rounded"},e[9]||(e[9]=[t("option",{value:"residential"},"Residential",-1),t("option",{value:"commercial"},"Commercial",-1),t("option",{value:"office"},"Office",-1)]),512),[[T,a.value.property_type]])]),t("div",J,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium mb-1"},"Square Feet",-1)),m(t("input",{type:"number","onUpdate:modelValue":e[1]||(e[1]=s=>a.value.square_feet=s),class:"w-full p-2 border rounded"},null,512),[[v,a.value.square_feet]])]),t("div",K,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium mb-1"},"Number of Movers",-1)),m(t("input",{type:"number","onUpdate:modelValue":e[2]||(e[2]=s=>a.value.movers_count=s),min:"1",class:"w-full p-2 border rounded"},null,512),[[v,a.value.movers_count]])]),t("div",Q,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium mb-1"},"Hourly Rate ($)",-1)),m(t("input",{type:"number","onUpdate:modelValue":e[3]||(e[3]=s=>a.value.hourly_rate=s),class:"w-full p-2 border rounded"},null,512),[[v,a.value.hourly_rate]])]),t("div",Z,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium mb-1"},"Departure Time",-1)),m(t("input",{type:"datetime-local","onUpdate:modelValue":e[4]||(e[4]=s=>a.value.departure_time=s),class:"w-full p-2 border rounded"},null,512),[[v,a.value.departure_time]])]),t("div",W,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium mb-1"},"Loading Address",-1)),m(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=s=>a.value.addresses[0].address=s),class:"w-full p-2 border rounded"},null,512),[[v,a.value.addresses[0].address]])]),t("div",X,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium mb-1"},"Unloading Address",-1)),m(t("input",{type:"text","onUpdate:modelValue":e[6]||(e[6]=s=>a.value.addresses[1].address=s),class:"w-full p-2 border rounded"},null,512),[[v,a.value.addresses[1].address]])]),q(k,{"small-button":"true",type:"submit",class:"w-full",disabled:r.value},{default:R(()=>[w(u(c.value?"Update":"Create")+" Request ",1)]),_:1},8,["disabled"])],32)])):(f(),b("main",Y,[t("div",ee,[e[17]||(e[17]=t("h2",{class:"text-[var(--color-text)] opacity-60 text-sm"},"Request number",-1)),t("p",te,u(p(o).selectedRequest.id),1)]),t("div",se,[e[18]||(e[18]=t("h2",{class:"text-[var(--color-text)] opacity-60 text-sm"},"Type",-1)),t("p",oe,u(p(o).selectedRequest.property_type)+" - "+u(p(o).selectedRequest.square_feet)+" sq ft",1)]),t("div",ae,[t("div",le,[e[19]||(e[19]=t("h2",{class:"text-[var(--color-text)] opacity-60 text-sm"},"Date",-1)),t("p",re,u(h.value),1)]),t("div",de,[e[20]||(e[20]=t("h2",{class:"text-[var(--color-text)] opacity-60 text-sm"},"Time",-1)),t("p",ue,u(D.value),1)])]),t("div",ie,[e[21]||(e[21]=t("h2",{class:"text-[var(--color-text)] opacity-60 text-sm"},"Loading address",-1)),t("p",ne,u(C.value),1)]),t("div",ce,[e[22]||(e[22]=t("h2",{class:"text-[var(--color-text)] opacity-60 text-sm"},"Unloading address",-1)),t("p",pe,u(S.value),1)]),t("div",me,[e[24]||(e[24]=t("h2",{class:"text-[var(--color-text)] text-lg font-semibold mb-2"},"Approximate price",-1)),t("div",ve,[e[23]||(e[23]=t("h2",{class:"text-[var(--color-text)] opacity-60 text-sm"},"Price",-1)),t("p",ge,"$"+u(p(o).selectedRequest.hourly_rate)+"/hr",1)])]),t("div",be,[t("button",{onClick:e[7]||(e[7]=s=>p(n).push({path:"/details",query:{id:p(o).selectedRequest.id}})),class:"bg-gray-500 text-white p-2 rounded hover:bg-gray-600"}," Edit "),q(k,{"small-button":"true",onClick:U,disabled:r.value},{default:R(()=>e[25]||(e[25]=[w(" Take request ")])),_:1},8,["disabled"])])])),q(L)]))}}),Re=M(fe,[["__scopeId","data-v-73cdd682"]]);export{Re as default};
